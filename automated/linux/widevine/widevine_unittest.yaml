metadata:
    name: widevine_unittest
    format: "Lava-Test-Shell Test Definition 1.0"
    description: "Widevine ce_cdm unit test"
    maintainer:
        - arthur.she@linaro.org
    os:
        - openembedded
        - debian
    scope:
        - functional
    devices:
        - imx8mq

params:
    ARTIFACTORIAL_URL: ""
    ARTIFACTORIAL_TOKEN: ""
    UPLOAD_TOOL: "../../utils/upload-to-artifactorial.sh"
    LOG_FILE: "widevine_ce_cdm_unittest.log"
    RESULT_FILE: "result.txt"

run:
    steps:
        - cd ./automated/linux/widevine/
        - ./widevine_unittest.sh -l ${LOG_FILE} -r ${RESULT_FILE}
        - ../../utils/send-to-lava.sh ${RESULT_FILE}
        # Upload log file to artifactirial
        - if [ -n "${ARTIFACTORIAL_TOKEN}" -a -n "${ARTIFACTORIAL_URL}" ]; then
        - gzip ${LOG_FILE}
        - ${UPLOAD_TOOL} -a "${LOG_FILE}.gz" -u "${ARTIFACTORIAL_URL}" -t "${ARTIFACTORIAL_TOKEN}"; fi

